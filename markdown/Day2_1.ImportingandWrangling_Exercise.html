<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Importing and Wrangling</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Importing and Wrangling</h1>



<p>Please go to Session on the RStudio Menu, and click on ‘Restart R and Clear Output’.</p>
<p>Tutorial adapted from: <a href="https://rafalab.github.io/dsbook/" class="uri">https://rafalab.github.io/dsbook/</a></p>
<div id="importing-data" class="section level1">
<h1>IMPORTING DATA</h1>
<div id="importing-data-from-electronic-spreadsheets" class="section level2">
<h2>Importing data from electronic spreadsheets</h2>
<div id="the-working-directory" class="section level3">
<h3>The working directory</h3>
<p>We recommend only using relative paths in your code. The reason is that full paths are unique to your computer and you want your code to be portable. You can get the full path of your working directory without writing it out explicitly by using the <code>getwd</code> function.</p>
<p>The current directory should be <code>/BasicR/markdown</code> If you need to change your working directory, you can use the function <code>setwd</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">getwd</span>()</span></code></pre></div>
</div>
<div id="identify-spreadsheet-you-want-to-load" class="section level3">
<h3>Identify spreadsheet you want to load</h3>
<p>Use the <code>dir</code> function to list spreadsheets available in the <code>/BasicsR/data</code> folder. Be careful of relative paths! Use <code>../</code> for the parent (<code>/BasicsR</code>) directory, and then access the <code>inst/extdata</code> folder.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">dir</span>(<span class="dt">path=</span><span class="st">&quot;../inst/extdata&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;messy_data.csv&quot; &quot;murders.csv&quot;</code></pre>
</div>
<div id="using-the-readr-package" class="section level3">
<h3>Using the readr package</h3>
<p>The <strong>readr</strong> library includes functions for reading data stored in text file spreadsheets into R. <strong>readr</strong> is part of the <strong>tidyverse</strong> package. Load all the tidyverse packages at once by installing and loading the <strong>tidyverse</strong> package.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.0.6     ✓ dplyr   1.0.3
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<p>And then use <code>read_csv</code> to read-in <code>murders.csv</code></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>dat&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;../inst/extdata/murders.csv&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">head</span>(dat)</span></code></pre></div>
<pre><code>##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65</code></pre>
</div>
</div>
<div id="importing-data-via-datasets-available-through-loaded-packages" class="section level2">
<h2>Importing data via datasets available through loaded packages</h2>
<p>You also import the same dataset directly through the <code>dslabs</code> package</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">library</span>(dslabs)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">data</span>(<span class="st">&quot;murders&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">head</span>(murders)</span></code></pre></div>
<pre><code>##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65</code></pre>
</div>
</div>
<div id="wrangling" class="section level1">
<h1>Wrangling</h1>
<p>We will be using data frames or <em>tibbles</em> for the majority of these exercises. We will focus on a specific data format referred to as <em>tidy</em> and on specific collection of packages that are particularly helpful for working with <em>tidy</em> data that are part of <em>tidyverse</em>.</p>
<div id="tidy-data" class="section level2">
<h2>Tidy data</h2>
<p>We say that a data table is in <em>tidy</em> format if each row represents one observation and columns represent the different variables available for each of these observations. The <code>murders</code> dataset is an example of a tidy data frame.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">head</span>(murders)</span></code></pre></div>
<pre><code>##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65</code></pre>
<p>Each row represent a state with each of the five columns providing a different variable related to these states: name, abbreviation, region, population, and total murders.</p>
</div>
<div id="tidying-manipulating-tibbles" class="section level2">
<h2>Tidying/ manipulating tibbles</h2>
<p>The <strong>dplyr</strong> package from the <strong>tidyverse</strong> introduces functions that perform some of the most common operations when working with <strong>dataframe</strong> and uses names for these functions that are relatively easy to remember. For instance, to change the data table by adding a new column, we use <code>mutate</code>. To filter the data table to a subset of rows, we use <code>filter</code>. Finally, to subset the data by selecting specific columns, we use <code>select</code>.</p>
<div id="adding-a-column-with-mutate" class="section level3">
<h3>Adding a column with <code>mutate</code></h3>
<p>The first task is to add the murder rates to our murders data frame. The function <code>mutate</code> takes the data frame as a first argument and the name and values of the variable as a second argument. So, to add murder rates, we use:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>murders &lt;-<span class="st"> </span><span class="kw">mutate</span>(murders, <span class="dt">rate =</span> total <span class="op">/</span><span class="st"> </span>population <span class="op">*</span><span class="st"> </span><span class="dv">100000</span>)</span></code></pre></div>
<p>Notice that here we used <code>total</code> and <code>population</code> inside the function, which are objects that are <strong>not</strong> defined in our workspace. This is one of <strong>dplyr</strong>’s main features. Functions in this package, such as <code>mutate</code>, know to look for variables in the data frame provided in the first argument.</p>
<p>We can see that the new column is added:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">head</span>(murders)</span></code></pre></div>
<pre><code>##        state abb region population total     rate
## 1    Alabama  AL  South    4779736   135 2.824424
## 2     Alaska  AK   West     710231    19 2.675186
## 3    Arizona  AZ   West    6392017   232 3.629527
## 4   Arkansas  AR  South    2915918    93 3.189390
## 5 California  CA   West   37253956  1257 3.374138
## 6   Colorado  CO   West    5029196    65 1.292453</code></pre>
<p>Although we have overwritten the original <code>murders</code> object, this does not change the object that loaded with <code>data(murders)</code>. If we load the <code>murders</code> data again, the original will overwrite our mutated version.</p>
</div>
<div id="subsetting-with-filter" class="section level3">
<h3>Subsetting with <code>filter</code></h3>
<p>Now suppose that we want to filter the data table to only show the entries for which the murder rate is lower than 0.71. To do this we use the <code>filter</code> function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">filter</span>(murders, rate <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.71</span>)</span></code></pre></div>
<pre><code>##           state abb        region population total      rate
## 1        Hawaii  HI          West    1360301     7 0.5145920
## 2          Iowa  IA North Central    3046355    21 0.6893484
## 3 New Hampshire  NH     Northeast    1316470     5 0.3798036
## 4  North Dakota  ND North Central     672591     4 0.5947151
## 5       Vermont  VT     Northeast     625741     2 0.3196211</code></pre>
</div>
<div id="selecting-columns-with-select" class="section level3">
<h3>Selecting columns with <code>select</code></h3>
<p>Although our data table only has six columns, some data tables include hundreds. If we want to view just a few, we can use the <strong>dplyr</strong> <code>select</code> function. In the code below we select three columns:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a> <span class="kw">select</span>(murders, state, region, rate)</span></code></pre></div>
<pre><code>##                   state        region       rate
## 1               Alabama         South  2.8244238
## 2                Alaska          West  2.6751860
## 3               Arizona          West  3.6295273
## 4              Arkansas         South  3.1893901
## 5            California          West  3.3741383
## 6              Colorado          West  1.2924531
## 7           Connecticut     Northeast  2.7139722
## 8              Delaware         South  4.2319369
## 9  District of Columbia         South 16.4527532
## 10              Florida         South  3.3980688
## 11              Georgia         South  3.7903226
## 12               Hawaii          West  0.5145920
## 13                Idaho          West  0.7655102
## 14             Illinois North Central  2.8369608
## 15              Indiana North Central  2.1900730
## 16                 Iowa North Central  0.6893484
## 17               Kansas North Central  2.2081106
## 18             Kentucky         South  2.6732010
## 19            Louisiana         South  7.7425810
## 20                Maine     Northeast  0.8280881
## 21             Maryland         South  5.0748655
## 22        Massachusetts     Northeast  1.8021791
## 23             Michigan North Central  4.1786225
## 24            Minnesota North Central  0.9992600
## 25          Mississippi         South  4.0440846
## 26             Missouri North Central  5.3598917
## 27              Montana          West  1.2128379
## 28             Nebraska North Central  1.7521372
## 29               Nevada          West  3.1104763
## 30        New Hampshire     Northeast  0.3798036
## 31           New Jersey     Northeast  2.7980319
## 32           New Mexico          West  3.2537239
## 33             New York     Northeast  2.6679599
## 34       North Carolina         South  2.9993237
## 35         North Dakota North Central  0.5947151
## 36                 Ohio North Central  2.6871225
## 37             Oklahoma         South  2.9589340
## 38               Oregon          West  0.9396843
## 39         Pennsylvania     Northeast  3.5977513
## 40         Rhode Island     Northeast  1.5200933
## 41       South Carolina         South  4.4753235
## 42         South Dakota North Central  0.9825837
## 43            Tennessee         South  3.4509357
## 44                Texas         South  3.2013603
## 45                 Utah          West  0.7959810
## 46              Vermont     Northeast  0.3196211
## 47             Virginia         South  3.1246001
## 48           Washington          West  1.3829942
## 49        West Virginia         South  1.4571013
## 50            Wisconsin North Central  1.7056487
## 51              Wyoming          West  0.8871131</code></pre>
</div>
<div id="the-pipe" class="section level3">
<h3>The pipe: <code>%&gt;%</code></h3>
<p>With <strong>dplyr</strong> we can perform a series of operations, for example <code>select</code> and then <code>filter</code>, by sending the results of one function to another using what is called the <em>pipe operator</em>: <code>%&gt;%</code>.</p>
<p>Show three variables (state, region, rate) for states that have murder rates below 0.71.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>murders <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(state, region, rate) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rate <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.71</span>)</span></code></pre></div>
<pre><code>##           state        region      rate
## 1        Hawaii          West 0.5145920
## 2          Iowa North Central 0.6893484
## 3 New Hampshire     Northeast 0.3798036
## 4  North Dakota North Central 0.5947151
## 5       Vermont     Northeast 0.3196211</code></pre>
<p>In general, the pipe <em>sends</em> the result of the left side of the pipe to be the first argument of the function on the right side of the pipe. Functions in <strong>tidyverse</strong> packages like <strong>dplyr</strong> have this format and can be used easily with the pipe.</p>
</div>
</div>
<div id="summarizing-data" class="section level2">
<h2>Summarizing data</h2>
<p>An important part of exploratory data analysis is summarizing data. The average and standard deviation are two examples of widely used summary statistics. More informative summaries can often be achieved by first splitting data into groups. In this section, we cover two new <strong>dplyr</strong> verbs that make these computations easier: <code>summarize</code> and <code>group_by</code>. We learn to access resulting values using the <code>pull</code> function.</p>
<div id="summarize" class="section level3">
<h3>Summarize with <code>summarize</code></h3>
<p>The <code>summarize</code> function in <strong>dplyr</strong> provides a way to compute summary statistics with intuitive and readable code. We continue with the murders dataset.</p>
<p>The following code computes the average and standard deviation of the population for the South region:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">data</span>(<span class="st">&quot;murders&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>s &lt;-<span class="st"> </span>murders <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;South&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">average =</span> <span class="kw">mean</span>(population), <span class="dt">standard_deviation =</span> <span class="kw">sd</span>(population))</span>
<span id="cb23-5"><a href="#cb23-5"></a>s</span></code></pre></div>
<pre><code>##   average standard_deviation
## 1 6804378            6516177</code></pre>
<p>This takes our original dataframe as input, filters it to keep only South region, and then produces a new summarized table with just the average and the standard deviation of populations We get to choose the names of the columns of the resulting table. For example, above we decided to use <code>average</code> and <code>standard_deviation</code>, but we could have used other names just the same.</p>
<p>Because the resulting table stored in <code>s</code> is a data frame, we can access the components with the accessor <code>$</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>s<span class="op">$</span>average</span></code></pre></div>
<pre><code>## [1] 6804378</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>s<span class="op">$</span>standard_deviation</span></code></pre></div>
<pre><code>## [1] 6516177</code></pre>
</div>
<div id="extract-variables-with-pull" class="section level3">
<h3>Extract variables with <code>pull</code></h3>
<p>When a data object is piped that object and its columns can also be accessed using the <code>pull</code> function. So instead of using the accessor <code>$</code>, we do the following</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>avg&lt;-murders <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;South&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">average =</span> <span class="kw">mean</span>(population), <span class="dt">standard_deviation =</span> <span class="kw">sd</span>(population)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="st">  </span><span class="kw">pull</span>(average)</span></code></pre></div>
<p>which is now a numeric:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">class</span>(avg)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
<div id="group-by" class="section level3">
<h3>Group then summarize with <code>group_by</code></h3>
<p>A common operation in data exploration is to first split data into groups and then compute summaries for each group. For example, we may want to compute the average and standard deviation for all regions separately. The <code>group_by</code> function helps us do this.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>murders <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(region)</span></code></pre></div>
<pre><code>## # A tibble: 51 x 5
## # Groups:   region [4]
##    state                abb   region    population total
##    &lt;chr&gt;                &lt;chr&gt; &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Alabama              AL    South        4779736   135
##  2 Alaska               AK    West          710231    19
##  3 Arizona              AZ    West         6392017   232
##  4 Arkansas             AR    South        2915918    93
##  5 California           CA    West        37253956  1257
##  6 Colorado             CO    West         5029196    65
##  7 Connecticut          CT    Northeast    3574097    97
##  8 Delaware             DE    South         897934    38
##  9 District of Columbia DC    South         601723    99
## 10 Florida              FL    South       19687653   669
## # … with 41 more rows</code></pre>
<p>The result does not look very different from <code>murders</code>. Using the <code>summarize</code> function below applies the summarization to each group separately.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>murders <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">average =</span> <span class="kw">mean</span>(population), <span class="dt">standard_deviation =</span> <span class="kw">sd</span>(population))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   region         average standard_deviation
## * &lt;fct&gt;            &lt;dbl&gt;              &lt;dbl&gt;
## 1 Northeast     6146360            6469174.
## 2 South         6804378.           6516177.
## 3 North Central 5577250.           4071916.
## 4 West          5534273.           9751150.</code></pre>
</div>
<div id="sorting-data-frames-with-arrange" class="section level3">
<h3>Sorting data frames with <code>arrange</code></h3>
<p>When examining a dataset, it is often convenient to sort the table by the different columns. For ordering entire tables, the <strong>dplyr</strong> function <code>arrange</code> is useful. For example, here we order the states by population size:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>murders <span class="op">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="st">  </span><span class="kw">arrange</span>(population) <span class="op">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##                  state abb        region population total
## 1              Wyoming  WY          West     563626     5
## 2 District of Columbia  DC         South     601723    99
## 3              Vermont  VT     Northeast     625741     2
## 4         North Dakota  ND North Central     672591     4
## 5               Alaska  AK          West     710231    19
## 6         South Dakota  SD North Central     814180     8</code></pre>
<p>Note that the default behavior is to order in ascending order. To sort the table in descending order:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>murders <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(population)) </span></code></pre></div>
<pre><code>##                   state abb        region population total
## 1            California  CA          West   37253956  1257
## 2                 Texas  TX         South   25145561   805
## 3               Florida  FL         South   19687653   669
## 4              New York  NY     Northeast   19378102   517
## 5              Illinois  IL North Central   12830632   364
## 6          Pennsylvania  PA     Northeast   12702379   457
## 7                  Ohio  OH North Central   11536504   310
## 8               Georgia  GA         South    9920000   376
## 9              Michigan  MI North Central    9883640   413
## 10       North Carolina  NC         South    9535483   286
## 11           New Jersey  NJ     Northeast    8791894   246
## 12             Virginia  VA         South    8001024   250
## 13           Washington  WA          West    6724540    93
## 14        Massachusetts  MA     Northeast    6547629   118
## 15              Indiana  IN North Central    6483802   142
## 16              Arizona  AZ          West    6392017   232
## 17            Tennessee  TN         South    6346105   219
## 18             Missouri  MO North Central    5988927   321
## 19             Maryland  MD         South    5773552   293
## 20            Wisconsin  WI North Central    5686986    97
## 21            Minnesota  MN North Central    5303925    53
## 22             Colorado  CO          West    5029196    65
## 23              Alabama  AL         South    4779736   135
## 24       South Carolina  SC         South    4625364   207
## 25            Louisiana  LA         South    4533372   351
## 26             Kentucky  KY         South    4339367   116
## 27               Oregon  OR          West    3831074    36
## 28             Oklahoma  OK         South    3751351   111
## 29          Connecticut  CT     Northeast    3574097    97
## 30                 Iowa  IA North Central    3046355    21
## 31          Mississippi  MS         South    2967297   120
## 32             Arkansas  AR         South    2915918    93
## 33               Kansas  KS North Central    2853118    63
## 34                 Utah  UT          West    2763885    22
## 35               Nevada  NV          West    2700551    84
## 36           New Mexico  NM          West    2059179    67
## 37        West Virginia  WV         South    1852994    27
## 38             Nebraska  NE North Central    1826341    32
## 39                Idaho  ID          West    1567582    12
## 40               Hawaii  HI          West    1360301     7
## 41                Maine  ME     Northeast    1328361    11
## 42        New Hampshire  NH     Northeast    1316470     5
## 43         Rhode Island  RI     Northeast    1052567    16
## 44              Montana  MT          West     989415    12
## 45             Delaware  DE         South     897934    38
## 46         South Dakota  SD North Central     814180     8
## 47               Alaska  AK          West     710231    19
## 48         North Dakota  ND North Central     672591     4
## 49              Vermont  VT     Northeast     625741     2
## 50 District of Columbia  DC         South     601723    99
## 51              Wyoming  WY          West     563626     5</code></pre>
</div>
</div>
<div id="reshaping-data-frames" class="section level2">
<h2>Reshaping data frames</h2>
<div id="longer" class="section level3">
<h3>Longer</h3>
<p><code>pivot_longer()</code> makes datasets <strong>longer</strong> by increasing the number of rows and decreasing the number of columns. The following sections show how to use <code>pivot_longer()</code> for a wide range of realistic datasets.</p>
<p>The <code>relig_income</code> dataset stores counts based on a survey which (among other things) asked people about their religion and annual income:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">data</span>(<span class="st">&quot;relig_income&quot;</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="kw">head</span>(relig_income)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Agnostic      27        34        60        81        76       137        122
## 2 Atheist       12        27        37        52        35        70         73
## 3 Buddhist      27        21        30        34        33        58         62
## 4 Catholic     418       617       732       670       638      1116        949
## 5 Don’t k…      15        14        15        11        10        35         21
## 6 Evangel…     575       869      1064       982       881      1486        949
## # … with 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;, `Don&#39;t
## #   know/refused` &lt;dbl&gt;</code></pre>
<p>This dataset contains three variables:</p>
<ul>
<li><code>religion</code>, stored in the rows,</li>
<li><code>income</code> spread across the column names, and</li>
<li><code>count</code> stored in the cell values.</li>
</ul>
<p>To tidy it we use <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>relig_income <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">!</span>religion, <span class="dt">names_to =</span> <span class="st">&quot;income&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 180 x 3
##    religion income             count
##    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;
##  1 Agnostic &lt;$10k                 27
##  2 Agnostic $10-20k               34
##  3 Agnostic $20-30k               60
##  4 Agnostic $30-40k               81
##  5 Agnostic $40-50k               76
##  6 Agnostic $50-75k              137
##  7 Agnostic $75-100k             122
##  8 Agnostic $100-150k            109
##  9 Agnostic &gt;150k                 84
## 10 Agnostic Don&#39;t know/refused    96
## # … with 170 more rows</code></pre>
<ul>
<li><p>The first argument is the dataset to reshape, <code>relig_income</code>.</p></li>
<li><p>The second argument describes which columns need to be reshaped. In this case, it’s every column apart from <code>religion</code>.</p></li>
<li><p>The <code>names_to</code> gives the name of the variable that will be created from the data stored in the column names, i.e. <code>income</code>.</p></li>
<li><p>The <code>values_to</code> gives the name of the variable that will be created from the data stored in the cell value, i.e. <code>count</code>.</p></li>
</ul>
</div>
<div id="wider" class="section level3">
<h3>Wider</h3>
<p><code>pivot_wider()</code> is the opposite of <code>pivot_longer()</code>: it makes a dataset <strong>wider</strong> by increasing the number of columns and decreasing the number of rows.</p>
</div>
</div>
<div id="joining-tables-with-left_join" class="section level2">
<h2>Joining tables with <code>left_join</code></h2>
<p>The information we need for a given analysis may not be just in one table. Suppose we want to explore the relationship between population size for US states and electoral votes. We have the population size in this table:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">data</span>(murders)</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">head</span>(murders)</span></code></pre></div>
<pre><code>##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65</code></pre>
<p>and electoral votes in this one:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">data</span>(polls_us_election_<span class="dv">2016</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">head</span>(results_us_election_<span class="dv">2016</span>)</span></code></pre></div>
<pre><code>##          state electoral_votes clinton trump others
## 1   California              55    61.7  31.6    6.7
## 2        Texas              38    43.2  52.2    4.5
## 3      Florida              29    47.8  49.0    3.2
## 4     New York              29    59.0  36.5    4.5
## 5     Illinois              20    55.8  38.8    5.4
## 6 Pennsylvania              20    47.9  48.6    3.6</code></pre>
<p>The <em>join</em> functions in the <strong>dplyr</strong> package make sure that the tables are combined so that matching rows are together. The general idea is that one needs to identify one or more columns that will serve to match the two tables. Then a new table with the combined information is returned.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>new_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(murders, results_us_election_<span class="dv">2016</span>, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>others) </span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="kw">head</span>(new_data)</span></code></pre></div>
<pre><code>##        state abb region population total electoral_votes clinton trump
## 1    Alabama  AL  South    4779736   135               9    34.4  62.1
## 2     Alaska  AK   West     710231    19               3    36.6  51.3
## 3    Arizona  AZ   West    6392017   232              11    45.1  48.7
## 4   Arkansas  AR  South    2915918    93               6    33.7  60.6
## 5 California  CA   West   37253956  1257              55    61.7  31.6
## 6   Colorado  CO   West    5029196    65               9    48.2  43.3</code></pre>
</div>
<div id="converting-to-tibble" class="section level2">
<h2>Converting to tibble</h2>
<p>The print method for tibbles is more readable than that of a data frame. Compare the outputs of the <strong>dataframe</strong> and <strong>tibble</strong>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">data</span>(<span class="st">&quot;murders&quot;</span>)</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">class</span>(murders)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>murders</span></code></pre></div>
<pre><code>##                   state abb        region population total
## 1               Alabama  AL         South    4779736   135
## 2                Alaska  AK          West     710231    19
## 3               Arizona  AZ          West    6392017   232
## 4              Arkansas  AR         South    2915918    93
## 5            California  CA          West   37253956  1257
## 6              Colorado  CO          West    5029196    65
## 7           Connecticut  CT     Northeast    3574097    97
## 8              Delaware  DE         South     897934    38
## 9  District of Columbia  DC         South     601723    99
## 10              Florida  FL         South   19687653   669
## 11              Georgia  GA         South    9920000   376
## 12               Hawaii  HI          West    1360301     7
## 13                Idaho  ID          West    1567582    12
## 14             Illinois  IL North Central   12830632   364
## 15              Indiana  IN North Central    6483802   142
## 16                 Iowa  IA North Central    3046355    21
## 17               Kansas  KS North Central    2853118    63
## 18             Kentucky  KY         South    4339367   116
## 19            Louisiana  LA         South    4533372   351
## 20                Maine  ME     Northeast    1328361    11
## 21             Maryland  MD         South    5773552   293
## 22        Massachusetts  MA     Northeast    6547629   118
## 23             Michigan  MI North Central    9883640   413
## 24            Minnesota  MN North Central    5303925    53
## 25          Mississippi  MS         South    2967297   120
## 26             Missouri  MO North Central    5988927   321
## 27              Montana  MT          West     989415    12
## 28             Nebraska  NE North Central    1826341    32
## 29               Nevada  NV          West    2700551    84
## 30        New Hampshire  NH     Northeast    1316470     5
## 31           New Jersey  NJ     Northeast    8791894   246
## 32           New Mexico  NM          West    2059179    67
## 33             New York  NY     Northeast   19378102   517
## 34       North Carolina  NC         South    9535483   286
## 35         North Dakota  ND North Central     672591     4
## 36                 Ohio  OH North Central   11536504   310
## 37             Oklahoma  OK         South    3751351   111
## 38               Oregon  OR          West    3831074    36
## 39         Pennsylvania  PA     Northeast   12702379   457
## 40         Rhode Island  RI     Northeast    1052567    16
## 41       South Carolina  SC         South    4625364   207
## 42         South Dakota  SD North Central     814180     8
## 43            Tennessee  TN         South    6346105   219
## 44                Texas  TX         South   25145561   805
## 45                 Utah  UT          West    2763885    22
## 46              Vermont  VT     Northeast     625741     2
## 47             Virginia  VA         South    8001024   250
## 48           Washington  WA          West    6724540    93
## 49        West Virginia  WV         South    1852994    27
## 50            Wisconsin  WI North Central    5686986    97
## 51              Wyoming  WY          West     563626     5</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>murders&lt;-<span class="kw">as_tibble</span>(murders)</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">class</span>(murders)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>murders</span></code></pre></div>
<pre><code>## # A tibble: 51 x 5
##    state                abb   region    population total
##    &lt;chr&gt;                &lt;chr&gt; &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Alabama              AL    South        4779736   135
##  2 Alaska               AK    West          710231    19
##  3 Arizona              AZ    West         6392017   232
##  4 Arkansas             AR    South        2915918    93
##  5 California           CA    West        37253956  1257
##  6 Colorado             CO    West         5029196    65
##  7 Connecticut          CT    Northeast    3574097    97
##  8 Delaware             DE    South         897934    38
##  9 District of Columbia DC    South         601723    99
## 10 Florida              FL    South       19687653   669
## # … with 41 more rows</code></pre>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
